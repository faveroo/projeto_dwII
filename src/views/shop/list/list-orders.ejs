<%- include('../partials/header') %>

    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <h1 class="text-white mb-4">
                    <i class="bi bi-bag-check me-2"></i>
                    Meus Pedidos
                </h1>
            </div>
        </div>

        <% if (orders.length===0) { %>
            <div class="row">
                <div class="col-12">
                    <div class="card bg-dark border-secondary">
                        <div class="card-body text-center py-5">
                            <i class="bi bi-inbox display-1 text-secondary mb-3"></i>
                            <h3 class="text-white mb-3">Você ainda não fez nenhum pedido</h3>
                            <p class="text-secondary mb-4">Comece a explorar nossos produtos!</p>
                            <a href="/product" class="btn btn-primary">
                                <i class="bi bi-shop me-2"></i>
                                Ver Produtos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <% } else { %>
                <div class="row">
                    <% orders.forEach(order=> {
                        const statusColors = {
                        'pending': 'warning',
                        'paid': 'info',
                        'shipped': 'primary',
                        'delivered': 'success',
                        'cancelled': 'danger'
                        };
                        const statusLabels = {
                        'pending': 'Pendente',
                        'paid': 'Pago',
                        'shipped': 'Enviado',
                        'delivered': 'Entregue',
                        'cancelled': 'Cancelado'
                        };
                        const statusColor = statusColors[order.status] || 'secondary';
                        const statusLabel = statusLabels[order.status] || order.status;
                        const orderDate = new Date(order.createdAt).toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                        });
                        %>
                        <div class="col-12 mb-4">
                            <div class="card bg-dark border-secondary">
                                <div class="card-header bg-secondary border-0">
                                    <div class="row align-items-center">
                                        <div class="col-md-6">
                                            <h5 class="text-white mb-0">
                                                <i class="bi bi-receipt me-2"></i>
                                                Pedido #<%= order.identification %>
                                            </h5>
                                        </div>
                                        <div class="col-md-6 text-md-end mt-2 mt-md-0">
                                            <span class="badge bg-<%= statusColor %> me-2">
                                                <%= statusLabel %>
                                            </span>
                                            <small class="text-white">
                                                <i class="bi bi-calendar me-1"></i>
                                                <%= orderDate %>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <% if (order.OrderItems && order.OrderItems.length> 0) { %>
                                        <div class="table-responsive">
                                            <table class="table table-dark table-sm mb-0">
                                                <thead class="border-secondary">
                                                    <tr>
                                                        <th class="text-white">Produto</th>
                                                        <th class="text-white text-center">Preço</th>
                                                        <th class="text-white text-center">Quantidade</th>
                                                        <th class="text-white text-end">Subtotal</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% order.OrderItems.forEach(item=> { %>
                                                        <tr>
                                                            <td class="text-white">
                                                                <i class="bi bi-box-seam me-2 text-secondary"></i>
                                                                <%= item.Product ? item.Product.name
                                                                    : 'Produto não encontrado' %>
                                                            </td>
                                                            <td class="text-white text-center">
                                                                R$ <%= item.Product ?
                                                                    Number(item.Product.price).toFixed(2) : '0.00' %>
                                                            </td>
                                                            <td class="text-center">
                                                                <span class="badge bg-primary">
                                                                    <%= item.quantity %>
                                                                </span>
                                                            </td>
                                                            <td class="text-white text-end">
                                                                R$ <%= (Number(item.Product ? item.Product.price : 0) *
                                                                    item.quantity).toFixed(2) %>
                                                            </td>
                                                        </tr>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                        </div>
                                        <% } else { %>
                                            <p class="text-secondary mb-0">Nenhum item neste pedido.</p>
                                            <% } %>
                                </div>
                                <div class="card-footer bg-dark border-secondary">
                                    <div class="row align-items-center">
                                        <div class="col-md-6">
                                            <small class="text-secondary">
                                                <i class="bi bi-info-circle me-1"></i>
                                                <%= order.OrderItems ? order.OrderItems.length : 0 %>
                                                    <%= order.OrderItems && order.OrderItems.length===1 ? 'item'
                                                        : 'itens' %>
                                            </small>
                                        </div>
                                        <div class="col-md-6 text-md-end mt-2 mt-md-0">
                                            <span class="text-white fw-bold fs-5">
                                                Total:
                                                <span class="text-primary">R$ <%= Number(order.total).toFixed(2) %>
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% }) %>
                </div>
                <% } %>
    </div>

    <%- include('../partials/footer') %>